{
  "title": "Caffe2 job's schema validation.",
  "type": "object",
  "properties": {
    "properties": {
      "type": "object",
      "description": "Defines Caffe2 job parameters.",
      "properties": {
        "experimentName": {
          "type": "string",
          "description": "Experiment description"
        },
        "priority": {
          "type": "integer",
          "default": "0",
          "description": "Priority associated with the job. Priority values can range from -1000 to 1000, with -1000 being the lowest priority and 1000 being the highest priority. The default value is 0."
        },
        "location": {
          "type": "string",
          "description": "Job's location (must match the cluster's location). Usually you would like to define it via Azure CLI command line parameters."
        },
        "cluster": {
          "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/ResourceId",
          "description": "Cluster resource Id. Usually you would like to define if via Azure CLI command line parameters."
        },
        "nodeCount": {
          "type": "integer",
          "description": "The job will be gang scheduled on that many compute nodes."
        },
        "containerSettings": {
          "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/ContainerSettings",
          "description": "Docker container settings. If not provided, the job will run on the VM."
        },
        "jobPreparation": {
          "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/JobPreparation",
          "description": "The specified actions will run on all the nodes that are part of the job."
        },
        "stdOutErrPathPrefix": {
          "type": "string",
          "description": "The path where the Batch AI service will upload jog's standard output and log files."
        },
        "inputDirectories": {
          "type": "array",
          "items": {
            "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/InputDirectory"
          },
          "description": "Input directories is a convinient way to specify location of training scripts and data."
        },
        "outputDirectories": {
          "type": "array",
          "items": {
            "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/OutputDirectory"
          },
          "description": "Output directories is a convinient way to specify location of output files generated by the job - models, tensorboard files, etc."
        },
        "environmentVariables": {
          "type": "array",
          "items": {
            "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/EnvironmentVariable"
          },
          "description": "User defined environment variables which will be available to the job and the job preparation task."
        },
        "secrets": {
          "type": "array",
          "items": {
            "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/EnvironmentVariableWithSecretValue"
          },
          "description": "User defined environment variables with secret values which will be available to the job and the job preparation task. The values will not be reported in get/list job responses."
        },
        "constraints": {
          "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/JobBasePropertiesConstraints",
          "description": "Constraints associated with the Job."
        },
        "caffe2Settings": {
          "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/Caffe2Settings"
        },
        "mountVolumes": {
          "$ref": "#/definitions/MountVolumes",
          "description": "These volumes will be mounted before the job execution and will be unmouted after the job completion. The volumes will be mounted at location specified by $AZ_BATCHAI_JOB_MOUNT_ROOT environment variable."
        }
      },
      "required": [
        "nodeCount",
        "caffe2Settings"
      ],
      "additionalProperties": false
    }
  },
  "definitions": {
    "MountVolumes": {
      "type": "object",
      "properties": {
        "azureFileShares": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/AzureFileShareReference"
          },
          "description": "Azure File Shares that are to be mounted to the cluster nodes during job execution."
        },
        "azureBlobFileSystems": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/AzureBlobFileSystemReference"
          }
        },
        "description": "Azure Blob Containers that are to be mounted to the cluster nodes during job execution."
      },
      "fileServers": {
        "type": "array",
        "items": {
          "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/FileServerReference"
        },
        "description": "File Servers that are to be mounted to the cluster nodes during job execution. Note, all file servers must be in the same subnet with the cluster."
      },
      "unmanagedFileSystems": {
        "type": "array",
        "items": {
          "$ref": "#/definitions/UnmanagedFileSystemReference"
        },
        "description": "Unmanaged file systems (specified by mount command) that are to be mounted to the cluster nodes during job execution."
      },
      "description": "Details of volumes to mount on the cluster during job execution."
    },
    "AzureBlobFileSystemReference": {
      "type": "object",
      "properties": {
        "accountName": {
          "type": "string"
        },
        "containerName": {
          "type": "string"
        },
        "credentials": {
          "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/AzureStorageCredentialsInfo",
          "description": "If omitted, Azure CLI will try to get credentials using current subscription."
        },
        "relativeMountPath": {
          "type": "string",
          "description": "The container will be mounted under $AZ_BATCHAI_JOB_MOUNT_ROOT/<relative mount path>."
        },
        "mountOptions": {
          "type": "string"
        }
      },
      "required": [
        "accountName",
        "containerName",
        "relativeMountPath"
      ],
      "description": "Provides required information, for the service to be able to mount Azure Blob Storage container on the cluster nodes."
    },
    "AzureFileShareReference": {
      "type": "object",
      "properties": {
        "accountName": {
          "type": "string",
          "description": "Optional. Azure CLI will populate it using information from azureFileUrl."
        },
        "azureFileUrl": {
          "type": "string"
        },
        "credentials": {
          "$ref": "https://raw.githubusercontent.com/Azure/azure-resource-manager-schemas/master/schemas/2018-03-01/Microsoft.BatchAI.json#/definitions/AzureStorageCredentialsInfo",
          "description": "If omitted, Azure CLI will try to get credentials using current subscription."
        },
        "relativeMountPath": {
          "type": "string",
          "description": "The share will be mounted under $AZ_BATCHAI_JOB_MOUNT_ROOT/<relative mount path>."
        },
        "fileMode": {
          "type": "string",
          "default": "0777",
          "description": "File mode for files. (Default: 0777)"
        },
        "directoryMode": {
          "type": "string",
          "default": "0777",
          "description": "File mode for directories. (Default: 0777)"
        }
      },
      "required": [
        "azureFileUrl",
        "relativeMountPath"
      ],
      "description": "Details of the Azure File Share to mount on the cluster."
    }
  }
}